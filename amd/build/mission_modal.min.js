define("block_mission_map/mission_modal",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events","core/templates"],(function($,ajax,notification,ModalFactory,ModalEvents,Templates){return{init:function(blockid,courseid){console.log("Mission modal init called with blockid:",blockid,"courseid:",courseid),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Add Mission",body:Templates.render("block_mission_map/add_mission_modal",{blockid:blockid,courseid:courseid})}).then((function(modal){console.log("Mission modal created successfully"),modal.getRoot().on("change","#missionType",(function(){console.log("Mission type changed");var type=$(this).val();"1"==type?($("#urlGroup").show(),$("#activityGroup").hide()):"2"==type?($("#urlGroup").hide(),$("#activityGroup").show(),ajax.call([{methodname:"block_mission_map_get_course_activities",args:{courseid:courseid}}])[0].then((function(response){console.log("Activities loaded:",response),response.success&&response.activities&&function(activities){activities;var dropdown=$("#missionActivitySelect");dropdown.empty(),dropdown.append('<option value="">{{#str}}select_activity, block_mission_map{{/str}}</option>'),activities.forEach((function(section){section.activities.length>0&&(dropdown.append('<optgroup label="'+section.section_name+'">'),section.activities.forEach((function(activity){var option=$("<option></option>").attr("value",activity.id).data("url",activity.url).text(activity.name+" ("+activity.type+")");dropdown.append(option)})),dropdown.append("</optgroup>"))}))}(response.activities)})).catch((function(error){console.log("Error loading activities:",error),notification.addNotification({message:"Error loading activities: "+error.message,type:"error"})}))):($("#urlGroup").hide(),$("#activityGroup").hide())}));function filterActivities(searchTerm){var dropdown=$("#missionActivitySelect");dropdown.find("option").each((function(){var option=$(this),text=option.text().toLowerCase();""===option.val()||""===searchTerm||text.includes(searchTerm)?option.show():option.hide()})),dropdown.find("optgroup").each((function(){var optgroup=$(this);0===optgroup.find("option:visible").not('[value=""]').length?optgroup.hide():optgroup.show()}))}modal.getRoot().on("input","#missionActivitySearch",(function(){filterActivities($(this).val().toLowerCase())})),modal.getRoot().on("click","#clearSearchBtn",(function(){$("#missionActivitySearch").val(""),filterActivities("")})),modal.getRoot().on("change","#missionActivitySelect",(function(){var selectedOption=$(this).find("option:selected"),cmid=selectedOption.val(),url=selectedOption.data("url");cmid?($("#selectedActivityUrl").val(url),console.log("Activity selected:",selectedOption.text(),"CMID:",cmid,"URL:",url)):$("#selectedActivityUrl").val("")})),modal.getRoot().on(ModalEvents.save,(function(e){console.log("Save mission event triggered"),e.preventDefault();var missionName=$("#missionName").val().trim(),missionType=$("#missionType").val(),missionUrl=$("#missionUrl").val(),selectedActivityId=$("#missionActivitySelect").val(),missionColor=$("#missionColor").val(),missionDescription=$("#missionDescription").val();if(missionName)if("1"!=missionType||missionUrl)if("2"!=missionType||selectedActivityId){var editingChapterId=modal.getRoot().data("editing-chapter-id"),data={blockid:blockid,courseid:courseid,chapterid:editingChapterId,name:missionName,description:missionDescription,type:parseInt(missionType),color:missionColor,url:"1"==missionType?missionUrl:"2"==missionType?$("#selectedActivityUrl").val():null,cmid:"2"==missionType?selectedActivityId:null};console.log("Sending mission data:",data),modal.getRoot().find('[data-action="save"]').prop("disabled",!0).text("Saving..."),ajax.call([{methodname:"block_mission_map_create_level",args:data}])[0].then((function(response){console.log("AJAX response:",response),response.success?(notification.addNotification({message:"Mission created successfully!",type:"success"}),modal.hide(),setTimeout((function(){window.location.reload()}),1e3)):notification.addNotification({message:response.message||"Error creating mission",type:"error"})})).catch((function(error){console.log("AJAX error:",error),notification.addNotification({message:"Error creating mission: "+error.message,type:"error"})})).always((function(){modal.getRoot().find('[data-action="save"]').prop("disabled",!1).text("Save")}))}else notification.addNotification({message:"Please select a course activity",type:"error"});else notification.addNotification({message:"Mission URL is required for URL type missions",type:"error"});else notification.addNotification({message:"Mission name is required",type:"error"})})),modal.getRoot().on(ModalEvents.hidden,(function(){console.log("Mission modal closed"),$("#addMissionForm")[0].reset(),$("#urlGroup").show(),$("#activityGroup").hide(),$("#missionActivitySearch").val(""),$("#missionActivitySelect").val("")})),$(document).on("click",".add-mission-btn",(function(e){e.preventDefault();var chapterId=$(this).data("chapter-id"),chapterName=$(this).data("chapter-name");console.log("Add mission clicked for chapter:",chapterId,chapterName),modal.getRoot().data("editing-chapter-id",chapterId),modal.getRoot().find(".modal-title").text("Add Mission to: "+chapterName),modal.show()})),console.log("Mission modal setup complete")})).catch((function(error){console.error("Error creating mission modal:",error),notification.addNotification({message:"Error creating mission modal: "+error.message,type:"error"})}))}}}));

//# sourceMappingURL=mission_modal.min.js.map