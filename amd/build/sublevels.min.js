define ("block_mission_map/sublevels",["exports","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/notification","core/templates"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init_add=void 0;b=h(b);c=h(c);d=h(d);e=h(e);f=h(f);g=h(g);function h(a){return a&&a.__esModule?a:{default:a}}var i=function(a){b.default.create({type:b.default.types.SAVE_CANCEL,title:"Add Sublevel",body:k(null,a)}).then(function(b){document.addEventListener("click",function(a){if(a.target&&a.target.classList.contains("add_sublevel")){j(a,b)}});var d=b.getRoot(),e=d.find("form");d.on(c.default.save,function(a){return l(a,e)});e.on("submit",function(c){return m(c,b,e,a)})}).then(function(a){a.close()})};a.init_add=i;var j=function(a,b){a.preventDefault();var c=b.getRoot();b.show();c.find("form").find("input[name=\"chapterid\"]").val(a.target.parentNode.dataset.cid);c.find("form").find("input[name=\"parentlevelid\"]").val(a.target.parentNode.dataset.plid)},k=function(a,b){if("undefined"==typeof a){a={}}var c={jsonformdata:JSON.stringify(a)};return d.default.loadFragment("block_mission_map","sublevel_form",b,c)},l=function(a,b){a.preventDefault();b.submit()},m=function(a,b,c,d){a.preventDefault();var f=c.serialize();e.default.call([{methodname:"block_mission_map_create_sublevel",args:{contextid:d,jsonformdata:JSON.stringify(f)},done:function done(a){return o(a,b)},fail:function fail(a){return n(a,b)}}])},n=function(a,b){b.hide();f.default.alert("Warning",JSON.parse(a),"Continue")},o=function(a,b){var c=JSON.parse(a.data),d={id:c.id,chapterid:c.chapterid,name:c.name,url:c.url},e=document.querySelector("[data-cid=\"".concat(c.chapterid,"\"]"));g.default.render("block_mission_map/dot",d).then(function(a,c){g.default.appendNodeContents(e,a,c);b.hide()}).fail(function(a){f.default.alert("Warning",a,"Continue")})}});
//# sourceMappingURL=sublevels.min.js.map
