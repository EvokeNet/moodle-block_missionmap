define("block_mission_map/sublevels",["exports","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/notification","core/templates"],(function(_exports,_modal_factory,_modal_events,_fragment,_ajax,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init_add=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init_add=function(contextid){_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:"Add Sublevel",body:get_form(null,contextid)}).then((function(modal){document.addEventListener("click",(function(event){event.target&&event.target.classList.contains("add_sublevel")&&showModal(event,modal)}));var root=modal.getRoot(),form=root.find("form");root.on(_modal_events.default.save,(function(event){return submitForm(event,form)})),form.on("submit",(function(event){return submitAddFormAjax(event,modal,form,contextid)}))})).then((function(modal){modal.close()}))};var showModal=function(event,modal){event.preventDefault();var root=modal.getRoot();modal.show(),root.find("form").find('input[name="chapterid"]').val(event.target.parentNode.dataset.cid),root.find("form").find('input[name="parentlevelid"]').val(event.target.parentNode.dataset.plid)},get_form=function(formdata,contextid){void 0===formdata&&(formdata={});var params={jsonformdata:JSON.stringify(formdata)};return _fragment.default.loadFragment("block_mission_map","sublevel_form",contextid,params)},submitForm=function(event,form){event.preventDefault(),form.submit()},submitAddFormAjax=function(event,modal,form,contextid){event.preventDefault();var formData=form.serialize();_ajax.default.call([{methodname:"block_mission_map_create_sublevel",args:{contextid:contextid,jsonformdata:JSON.stringify(formData)},done:function(data){return handleAddFormSubmissionResponse(data,modal)},fail:function(data){return handleFormSubmissionFailure(data,modal)}}])},handleFormSubmissionFailure=function(data,modal){modal.hide(),_notification.default.alert("Warning",JSON.parse(data),"Continue")},handleAddFormSubmissionResponse=function(data,modal){var level=JSON.parse(data.data),context={id:level.id,chapterid:level.chapterid,name:level.name,url:level.url},chapter=document.querySelector('[data-cid="'.concat(level.chapterid,'"]'));_templates.default.render("block_mission_map/dot",context).then((function(html,js){_templates.default.appendNodeContents(chapter,html,js),modal.hide()})).fail((function(ex){_notification.default.alert("Warning",ex,"Continue")}))}}));

//# sourceMappingURL=sublevels.min.js.map