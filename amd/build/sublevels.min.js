define("block_mission_map/sublevels",["exports","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/notification","core/templates"],(function(_exports,_modal_factory,_modal_events,_fragment,_ajax,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init_add=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init_add=contextid=>{_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:"Add Sublevel",body:get_form(null,contextid)}).then((modal=>{document.addEventListener("click",(event=>{event.target&&event.target.classList.contains("add_sublevel")&&showModal(event,modal)}));const root=modal.getRoot(),form=root.find("form");root.on(_modal_events.default.save,(event=>submitForm(event,form))),form.on("submit",(event=>submitAddFormAjax(event,modal,form,contextid)))})).then((modal=>{modal.close()}))};const showModal=(event,modal)=>{event.preventDefault();let root=modal.getRoot();modal.show(),root.find("form").find('input[name="chapterid"]').val(event.target.parentNode.dataset.cid),root.find("form").find('input[name="parentlevelid"]').val(event.target.parentNode.dataset.plid)},get_form=(formdata,contextid)=>{void 0===formdata&&(formdata={});var params={jsonformdata:JSON.stringify(formdata)};return _fragment.default.loadFragment("block_mission_map","sublevel_form",contextid,params)},submitForm=(event,form)=>{event.preventDefault(),form.submit()},submitAddFormAjax=(event,modal,form,contextid)=>{event.preventDefault();let formData=form.serialize();_ajax.default.call([{methodname:"block_mission_map_create_sublevel",args:{contextid:contextid,jsonformdata:JSON.stringify(formData)},done:data=>handleAddFormSubmissionResponse(data,modal),fail:data=>handleFormSubmissionFailure(data,modal)}])},handleFormSubmissionFailure=(data,modal)=>{modal.hide(),_notification.default.alert("Warning",JSON.parse(data),"Continue")},handleAddFormSubmissionResponse=(data,modal)=>{let level=JSON.parse(data.data),context={id:level.id,chapterid:level.chapterid,name:level.name,url:level.url};const chapter=document.querySelector('[data-cid="'.concat(level.chapterid,'"]'));_templates.default.render("block_mission_map/dot",context).then(((html,js)=>{_templates.default.appendNodeContents(chapter,html,js),modal.hide()})).fail((ex=>{_notification.default.alert("Warning",ex,"Continue")}))}}));

//# sourceMappingURL=sublevels.min.js.map