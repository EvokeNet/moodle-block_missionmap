define ("block_mission_map/levels",["exports","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/notification","core/templates","jquery"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init_edit=a.init_add=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=i(f);g=i(g);h=i(h);function i(a){return a&&a.__esModule?a:{default:a}}var j=function(a){b.default.create({type:b.default.types.SAVE_CANCEL,title:"Add Level",body:m(null,a)}).then(function(b){document.addEventListener("click",function(a){if(a.target&&a.target.classList.contains("add_level")){l(a,b)}});document.addEventListener("mousedown",function(b){if(b.target&&b.target.classList.contains("mission")){t(b,b.target,a)}});for(var d=document.querySelectorAll(".add_level"),e=document.querySelectorAll(".mission"),f=b.getRoot(),g=f.find("form"),h=0;h<d.length;h++){d[h].addEventListener("click",function(a){return l(a,b)})}for(var j=function(b){e[b].addEventListener("mousedown",function(c){return t(c,e[b],a)})},k=0;k<e.length;k++){j(k)}f.on(c.default.save,function(a){return n(a,g)});g.on("submit",function(c){return o(c,b,g,a)})}).then(function(a){a.close()})};a.init_add=j;a.init_edit=function init_edit(a){document.addEventListener("click",function(b){if(b.target&&b.target.classList.contains("edit_level")){k(b,a)}})};var k=function(a,d){var e={chapterid:a.target.parentNode.parentNode.dataset.cid,levelid:a.target.dataset.lid};b.default.create({type:b.default.types.SAVE_CANCEL,title:"Edit Level",body:m(e,d)}).then(function(a){var b=a.getRoot(),e=b.find("form");b.on(c.default.save,function(a){return n(a,e)});e.on("submit",function(b){return p(b,a,e,d)});a.show()}).then(function(a){a.close()})},l=function(a,b){a.preventDefault();var c=b.getRoot();b.show();c.find("form").find("input[name=\"chapterid\"]").val(a.target.parentNode.dataset.cid)},m=function(a,b){if("undefined"==typeof a){a={}}var c={jsonformdata:JSON.stringify(a)};return d.default.loadFragment("block_mission_map","level_form",b,c)},n=function(a,b){a.preventDefault();b.submit()},o=function(a,b,c,d){a.preventDefault();var f=c.serialize();e.default.call([{methodname:"block_mission_map_create_level",args:{contextid:d,jsonformdata:JSON.stringify(f)},done:function done(a){return r(a,b)},fail:function fail(a){return q(a,b)}}])},p=function(a,b,c,d){a.preventDefault();var f=c.serialize();e.default.call([{methodname:"block_mission_map_edit_level",args:{contextid:d,jsonformdata:JSON.stringify(f)},done:function done(a){return s(a,b)},fail:function fail(a){return q(a,b)}}])},q=function(a,b){b.hide();f.default.alert("Warning",JSON.parse(a),"Continue")},r=function(a,b){var c=JSON.parse(a.data),d={id:c.id,chapterid:c.chapterid,name:c.name,url:c.url},e=document.querySelector("[data-cid=\"".concat(c.chapterid,"\"]"));g.default.render("block_mission_map/level",d).then(function(a,c){g.default.appendNodeContents(e,a,c);b.hide()}).fail(function(a){f.default.alert("Warning",a,"Continue")})},s=function(a,b){var c=JSON.parse(a.data),d=document.querySelector("[data-lid=\"".concat(c.levelid,"\"]"));d.href=c.url;b.hide()},t=function(a,b,c){a.preventDefault();b.classList.add("dimmed");b.style.cursor="move";var d=a.clientX-b.offsetLeft,e=a.clientY-b.offsetTop;b.onmousemove=function(a){b.style.top=(a.clientY-e).toString()+"px";b.style.left=(a.clientX-d).toString()+"px"};document.onmouseup=function(){b.onmousemove=null;b.style.cursor="pointer";b.classList.remove("dimmed");var a=(0,h.default)(".block_mission_map_level_edit_form");document.getElementById("levelid").value=b.dataset.lid;document.getElementById("chapterid").value=b.parentNode.dataset.cid;document.getElementById("posx").value=b.style.top;document.getElementById("posy").value=b.style.left;u(a,c)};b.ondragstart=function(){return!1}},u=function(a,b){var c=a.serialize();e.default.call([{methodname:"block_mission_map_edit_level",args:{contextid:b,jsonformdata:JSON.stringify(c)},done:function done(a){return w(a)},fail:function fail(a){return v(a)}}])},v=function(a){f.default.alert("Warning",JSON.stringify(a),"Continue");return!1},w=function(a){f.default.alert("Success",a,"Continue")}});
//# sourceMappingURL=levels.min.js.map
