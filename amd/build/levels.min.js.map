{"version":3,"sources":["../src/levels.js"],"names":["init_add","contextid","ModalFactory","create","type","types","SAVE_CANCEL","title","body","get_form","then","modal","document","addEventListener","event","target","classList","contains","showModal","dragstart","triggers","querySelectorAll","missions","root","getRoot","form","find","i","length","on","ModalEvents","save","submitForm","submitAddFormAjax","close","init_edit","create_modal","formdata","chapterid","parentNode","dataset","cid","levelid","lid","submitEditFormAjax","show","preventDefault","val","params","jsonformdata","JSON","stringify","Fragment","loadFragment","submit","formData","serialize","Ajax","call","methodname","args","done","data","handleAddFormSubmissionResponse","fail","handleFormSubmissionFailure","handleEditFormSubmissionResponse","hide","Notification","alert","parse","level","context","id","name","url","chapter","querySelector","Template","render","html","js","appendNodeContents","ex","level_data","href","element","add","style","cursor","cOffX","clientX","offsetLeft","cOffY","clientY","offsetTop","onmousemove","top","toString","left","onmouseup","remove","level_edit_form","getElementById","value","submitLevelEditFormAjax","ondragstart","handleLevelEditFormSubmissionResponse","handleLevelEditFormSubmissionFailure"],"mappings":"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","sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Fragment from 'core/fragment';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Template from 'core/templates';\nimport $ from 'jquery';\n\n// The function called from the Mustache template to render the ADD_LEVEL modal\nexport const init_add = (contextid) => {\n    // Set up a SAVE_CANCEL modal.\n    ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: 'Add Level',\n        body: get_form(null, contextid),\n    })\n        // Set up the listeners\n        .then((modal) => {\n            document.addEventListener('click', (event) => {\n                if (\n                    event.target &&\n                    event.target.classList.contains('add_level')\n                ) {\n                    showModal(event, modal);\n                }\n            });\n            document.addEventListener('mousedown', (event) => {\n                if (\n                    event.target &&\n                    event.target.classList.contains('mission')\n                ) {\n                    dragstart(event, event.target, contextid);\n                }\n            });\n            const triggers = document.querySelectorAll('.add_level');\n            const missions = document.querySelectorAll('.mission');\n            const root = modal.getRoot();\n            const form = root.find('form');\n\n            // Adds click event listeners to all buttons already added to the DOM\n            for (let i = 0; i < triggers.length; i++) {\n                triggers[i].addEventListener('click', (event) =>\n                    showModal(event, modal)\n                );\n            }\n\n            // Adds dragging event listeners to all missions already added to the DOM\n            for (let i = 0; i < missions.length; i++) {\n                missions[i].addEventListener('mousedown', (event) =>\n                    dragstart(event, missions[i], contextid)\n                );\n            }\n\n            root.on(ModalEvents.save, (event) => submitForm(event, form));\n            form.on('submit', (event) =>\n                submitAddFormAjax(event, modal, form, contextid)\n            );\n        })\n        // Close modal\n        .then((modal) => {\n            modal.close();\n        });\n};\n\n// The function called from the Mustache template to render the EDIT_LEVEL modal\nexport const init_edit = (contextid) => {\n    document.addEventListener('click', (event) => {\n        if (event.target && event.target.classList.contains('edit_level')) {\n            create_modal(event, contextid);\n        }\n    });\n};\n\n// Assembles EDIT_LEVEL modal with prefilled data\nconst create_modal = (event, contextid) => {\n    // Pass data to the modal\n    const formdata = {\n        chapterid: event.target.parentNode.parentNode.dataset.cid,\n        levelid: event.target.dataset.lid,\n    };\n\n    // Set up a SAVE_CANCEL modal.\n    ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: 'Edit Level',\n        body: get_form(formdata, contextid),\n    })\n        // Set up the modal events\n        .then((modal) => {\n            const root = modal.getRoot();\n            const form = root.find('form');\n\n            root.on(ModalEvents.save, (event) => submitForm(event, form));\n            form.on('submit', (event) =>\n                submitEditFormAjax(event, modal, form, contextid)\n            );\n\n            modal.show();\n        })\n        // Close modal\n        .then((modal) => {\n            modal.close();\n        });\n};\n\nconst showModal = (event, modal) => {\n    event.preventDefault();\n    let root = modal.getRoot();\n    modal.show();\n    // Adds chapter ID to invoked modal form so we can save to DB\n    root.find('form')\n        .find('input[name=\"chapterid\"]')\n        .val(event.target.parentNode.dataset.cid);\n};\n\nconst get_form = (formdata, contextid) => {\n    if (typeof formdata === 'undefined') {\n        formdata = {};\n    }\n    var params = { jsonformdata: JSON.stringify(formdata) };\n    return Fragment.loadFragment(\n        'block_mission_map',\n        'level_form',\n        contextid,\n        params\n    );\n};\n\nconst submitForm = (event, form) => {\n    event.preventDefault();\n    form.submit();\n};\n\nconst submitAddFormAjax = (event, modal, form, contextid) => {\n    event.preventDefault();\n\n    let formData = form.serialize();\n    Ajax.call([\n        {\n            methodname: 'block_mission_map_create_level',\n            args: {\n                contextid: contextid,\n                jsonformdata: JSON.stringify(formData),\n            },\n            done: (data) => handleAddFormSubmissionResponse(data, modal),\n            fail: (data) => handleFormSubmissionFailure(data, modal),\n        },\n    ]);\n};\n\nconst submitEditFormAjax = (event, modal, form, contextid) => {\n    event.preventDefault();\n\n    let formData = form.serialize();\n    Ajax.call([\n        {\n            methodname: 'block_mission_map_edit_level',\n            args: {\n                contextid: contextid,\n                jsonformdata: JSON.stringify(formData),\n            },\n            done: (data) => handleEditFormSubmissionResponse(data, modal),\n            fail: (data) => handleFormSubmissionFailure(data, modal),\n        },\n    ]);\n};\n\nconst handleFormSubmissionFailure = (data, modal) => {\n    modal.hide();\n    Notification.alert('Warning', JSON.parse(data), 'Continue');\n};\n\n/**\n *   level {\n *       id: 0,\n *       chapterid: 0,\n *       parentlevelid: 0,\n *       name: 'LevelName',\n *       url: 'https://levelurl',\n *       timecreated: 0000000000,\n *       timemodified: 0000000000\n *   }\n **/\nconst handleAddFormSubmissionResponse = (data, modal) => {\n    let level = JSON.parse(data.data);\n    let context = {\n        id: level.id,\n        chapterid: level.chapterid,\n        name: level.name,\n        url: level.url,\n    };\n\n    const chapter = document.querySelector(`[data-cid=\"${level.chapterid}\"]`);\n\n    Template.render('block_mission_map/level', context)\n        .then((html, js) => {\n            Template.appendNodeContents(chapter, html, js);\n            modal.hide();\n        })\n        .fail((ex) => {\n            Notification.alert('Warning', ex, 'Continue');\n        });\n};\n\nconst handleEditFormSubmissionResponse = (data, modal) => {\n    let level_data = JSON.parse(data.data);\n    const level = document.querySelector(`[data-lid=\"${level_data.levelid}\"]`);\n    level.href = level_data.url;\n    modal.hide();\n};\n\nconst dragstart = (event, element, contextid) => {\n    event.preventDefault();\n\n    element.classList.add('dimmed');\n    element.style.cursor = 'move';\n\n    let cOffX = event.clientX - element.offsetLeft;\n    let cOffY = event.clientY - element.offsetTop;\n\n    element.onmousemove = (event) => {\n        element.style.top = (event.clientY - cOffY).toString() + 'px';\n        element.style.left = (event.clientX - cOffX).toString() + 'px';\n    };\n\n    document.onmouseup = () => {\n        element.onmousemove = null;\n        element.style.cursor = 'pointer';\n        element.classList.remove('dimmed');\n\n        const level_edit_form = $('.block_mission_map_level_edit_form');\n        document.getElementById('levelid').value = element.dataset.lid;\n        document.getElementById('chapterid').value =\n            element.parentNode.dataset.cid;\n        document.getElementById('posx').value = element.style.top;\n        document.getElementById('posy').value = element.style.left;\n        submitLevelEditFormAjax(level_edit_form, contextid);\n    };\n\n    element.ondragstart = () => {\n        return false;\n    };\n};\n\nconst submitLevelEditFormAjax = (form, contextid) => {\n    let formData = form.serialize();\n    Ajax.call([\n        {\n            methodname: 'block_mission_map_edit_level',\n            args: {\n                contextid: contextid,\n                jsonformdata: JSON.stringify(formData),\n            },\n            done: (data) => handleLevelEditFormSubmissionResponse(data),\n            fail: (data) => handleLevelEditFormSubmissionFailure(data),\n        },\n    ]);\n};\n\nconst handleLevelEditFormSubmissionFailure = (data) => {\n    Notification.alert('Warning', JSON.stringify(data), 'Continue');\n    return false;\n};\n\nconst handleLevelEditFormSubmissionResponse = (data) => {\n    Notification.alert('Success', data, 'Continue');\n};\n/* eslint-disable */\n/* eslint-enable */\n"],"file":"levels.min.js"}