{"version":3,"sources":["../src/levels.js"],"names":["init","contextid","ModalFactory","create","type","types","SAVE_CANCEL","title","body","get_form","then","modal","document","addEventListener","event","target","classList","contains","showModal","triggers","querySelectorAll","missions","root","getRoot","form","find","i","length","dragstart","on","ModalEvents","save","submitForm","submitFormAjax","close","preventDefault","show","val","parentNode","dataset","cid","formdata","params","jsonformdata","JSON","stringify","Fragment","loadFragment","submit","formData","serialize","Ajax","call","methodname","args","done","data","handleFormSubmissionResponse","fail","handleFormSubmissionFailure","hide","Notification","alert","parse","level","context","id","chapterid","name","url","chapter","querySelector","Template","render","html","js","appendNodeContents","ex","element","add","cOffX","clientX","offsetLeft","cOffY","clientY","offsetTop","dragmove","dragend","style","cursor","window","console","log","top","toString","left","removeEventListener","remove"],"mappings":"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","sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Fragment from 'core/fragment';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Template from 'core/templates';\n\n// The function called from the Mustache template.\nexport const init = (contextid) => {\n    // Set up a SAVE_CANCEL modal.\n    ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: 'Add Level',\n        body: get_form(null, contextid),\n    })\n        // Set up the listeners\n        .then((modal) => {\n            document.addEventListener('click', (event) => {\n                if (\n                    event.target &&\n                    event.target.classList.contains('add_level')\n                ) {\n                    showModal(event, modal);\n                }\n            });\n            // document.addEventListener('mousedown', (event) => {\n            //     if (\n            //         event.target &&\n            //         event.target.classList.contains('mission')\n            //     ) {\n            //         userPressed(event);\n            //     }\n            // });\n            const triggers = document.querySelectorAll('.add_level');\n            const missions = document.querySelectorAll('.mission');\n            const root = modal.getRoot();\n            const form = root.find('form');\n\n            // Adds click event listeners to all buttons already added to the DOM\n            for (let i = 0; i < triggers.length; i++) {\n                triggers[i].addEventListener('click', (event) =>\n                    showModal(event, modal)\n                );\n            }\n\n            // Adds dragging event listeners to all missions already added to the DOM\n            for (let i = 0; i < missions.length; i++) {\n                missions[i].addEventListener('mousedown', (event) =>\n                    dragstart(event, missions[i])\n                );\n                missions[i].addEventListener('dragstart', () => {\n                    return false;\n                });\n            }\n\n            root.on(ModalEvents.save, (event) => submitForm(event, form));\n            form.on('submit', (event) =>\n                submitFormAjax(event, modal, form, contextid)\n            );\n        })\n        // Close modal\n        .then((modal) => {\n            modal.close();\n        });\n};\n\nconst showModal = (event, modal) => {\n    event.preventDefault();\n    let root = modal.getRoot();\n    modal.show();\n    // Adds chapter ID to invoked modal form so we can save to DB\n    root.find('form')\n        .find('input[name=\"chapterid\"]')\n        .val(event.target.parentNode.dataset.cid);\n};\n\nconst get_form = (formdata, contextid) => {\n    if (typeof formdata === 'undefined') {\n        formdata = {};\n    }\n    var params = { jsonformdata: JSON.stringify(formdata) };\n    return Fragment.loadFragment(\n        'block_mission_map',\n        'level_form',\n        contextid,\n        params\n    );\n};\n\nconst submitForm = (event, form) => {\n    event.preventDefault();\n    form.submit();\n};\n\nconst submitFormAjax = (event, modal, form, contextid) => {\n    event.preventDefault();\n\n    let formData = form.serialize();\n    Ajax.call([\n        {\n            methodname: 'block_mission_map_create_level',\n            args: {\n                contextid: contextid,\n                jsonformdata: JSON.stringify(formData),\n            },\n            done: (data) => handleFormSubmissionResponse(data, modal),\n            fail: (data) => handleFormSubmissionFailure(data, modal),\n        },\n    ]);\n};\n\nconst handleFormSubmissionFailure = (data, modal) => {\n    modal.hide();\n    Notification.alert('Warning', JSON.parse(data), 'Continue');\n};\n\n/**\n *   level {\n *       id: 0,\n *       chapterid: 0,\n *       parentlevelid: 0,\n *       name: 'LevelName',\n *       url: 'https://levelurl',\n *       timecreated: 0000000000,\n *       timemodified: 0000000000\n *   }\n **/\nconst handleFormSubmissionResponse = (data, modal) => {\n    let level = JSON.parse(data.data);\n    let context = {\n        id: level.id,\n        chapterid: level.chapterid,\n        name: level.name,\n        url: level.url,\n    };\n\n    const chapter = document.querySelector(`[data-cid=\"${level.chapterid}\"]`);\n\n    Template.render('block_mission_map/level', context)\n        .then((html, js) => {\n            Template.appendNodeContents(chapter, html, js);\n            modal.hide();\n        })\n        .fail((ex) => {\n            Notification.alert('Warning', ex, 'Continue');\n        });\n};\n\nconst dragstart = (event, element) => {\n    event.preventDefault();\n    element.classList.add('dimmed');\n    let cOffX = event.clientX - element.offsetLeft;\n    let cOffY = event.clientY - element.offsetTop;\n    element.addEventListener('mousemove', (event) =>\n        dragmove(event, element, cOffX, cOffY)\n    );\n    element.addEventListener('mouseup', (event) => dragend(event, element));\n    element.style.cursor = 'move';\n};\n\nconst dragmove = (event, element, cOffX, cOffY) => {\n    window.console.log('dragggggiiiiinnnnnggggg');\n    event.preventDefault();\n    element.style.top = (event.clientY - cOffY).toString() + 'px';\n    element.style.left = (event.clientX - cOffX).toString() + 'px';\n};\n\nconst dragend = (event, element) => {\n    event.preventDefault();\n    window.console.log('STAHP');\n    element.removeEventListener('mousemove', dragmove);\n    element.removeEventListener('mouseup', dragend);\n    element.classList.remove('dimmed');\n};\n/* eslint-disable */\n/* eslint-enable */\n"],"file":"levels.min.js"}