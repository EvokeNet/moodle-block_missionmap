define("block_mission_map/chapter_modal",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events","core/templates"],(function($,ajax,notification,ModalFactory,ModalEvents,Templates){return{init:function(blockid,courseid){console.log("Chapter modal init called with blockid:",blockid,"courseid:",courseid),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Add Chapter",body:Templates.render("block_mission_map/add_chapter_modal",{blockid:blockid,courseid:courseid})}).then((function(modal){console.log("Modal created successfully"),modal.getRoot().on("change","#hasLock",(function(){console.log("HasLock checkbox changed"),$(this).is(":checked")?$("#unlockDateGroup").show():$("#unlockDateGroup").hide()})),modal.getRoot().on(ModalEvents.save,(function(e){console.log("Save event triggered"),e.preventDefault();var chapterName=$("#chapterName").val().trim();if(chapterName){var hasLock=$("#hasLock").is(":checked"),unlockingDate=hasLock?$("#unlockDate").val():null,editingChapterId=modal.getRoot().data("editing-chapter-id"),data={blockid:blockid,courseid:courseid,name:chapterName,has_lock:hasLock?1:0,unlocking_date:unlockingDate};editingChapterId&&(data.chapterid=editingChapterId),console.log("Sending data:",data),modal.getRoot().find('[data-action="save"]').prop("disabled",!0).text("Saving..."),ajax.call([{methodname:"block_mission_map_create_chapter",args:data}])[0].then((function(response){console.log("AJAX response:",response),response.success?(notification.addNotification({message:editingChapterId?"Chapter updated successfully!":"Chapter created successfully!",type:"success"}),modal.hide(),setTimeout((function(){window.location.reload()}),1e3)):notification.addNotification({message:response.message||"Error saving chapter",type:"error"})})).catch((function(error){console.log("AJAX error:",error),notification.addNotification({message:"Error saving chapter: "+error.message,type:"error"})})).always((function(){modal.getRoot().find('[data-action="save"]').prop("disabled",!1).text("Save")}))}else notification.addNotification({message:"Chapter name is required",type:"error"})})),modal.getRoot().on(ModalEvents.hidden,(function(){console.log("Modal closed"),$("#addChapterForm")[0].reset(),$("#unlockDateGroup").hide()})),$('button[data-target="#addChapterModal"], .editing_add_chapter').on("click",(function(e){e.preventDefault(),console.log("Button clicked, showing modal"),modal.show()})),$(document).on("click",".edit-chapter-btn",(function(e){e.preventDefault();var chapterId=$(this).data("chapter-id"),chapterName=$(this).data("chapter-name"),hasLock=$(this).data("has-lock"),unlockDate=$(this).data("unlock-date");console.log("Edit chapter clicked:",chapterId),$("#chapterName").val(chapterName),$("#hasLock").prop("checked",1==hasLock),1==hasLock?($("#unlockDateGroup").show(),unlockDate&&$("#unlockDate").val(unlockDate)):$("#unlockDateGroup").hide(),modal.getRoot().data("editing-chapter-id",chapterId),modal.show()})),console.log("Modal setup complete")})).catch((function(error){console.error("Error creating modal:",error),notification.addNotification({message:"Error creating modal: "+error.message,type:"error"})}))}}}));

//# sourceMappingURL=chapter_modal.min.js.map